<?xml version="1.0" encoding="UTF-8"?>
<Module>
	<ModulePrefs title="Findings.xml Datos de los últimos eventos con los últimos tópics."
		description=""
		author_affiliation="Capgemini">
    <Require feature="idi"/>
    <Require feature="locked-domain" />
  </ModulePrefs>
  
  <UserPref name="_table_query_url" default_value="" display_name="Data source url (Ej:https://docs.google.com/spreadsheet/ccc?key=0AoYEewut2JmZdG5HM2VLTTdwQUlLdmhnMk1DLXBWZl)" required="true" />
  
  <Content type="html">
    <![CDATA[

    <script src="https://www.google.com/jsapi" type="text/javascript"></script>

    <style type="text/css">       
      img.loading {
        margin: 5px 0 0 29px;
      }
      
      a {color: #62B4E6 !important;}
    
      a:visited {color: #476BB5 !important;}
  h2 {
        font-size: 32px;
        font-weight: normal;
        margin: 0px 0 5px 0;
        padding-bottom: 5px;
         position:relative;
 top:27px;
 font-family: "BBVA Web Light", arial, sans-serif;
 width:300px;       `
      }
      h2 span {
        font-weight: bold;
      }
        body {background-color:transparent;}

    #all {
   padding-left:866px;
   font-size:12px;
   font-family:Arial;
   height:30px;
     }

  #all a{
     text-decoration:none;
    }
    
    @media screen and (-webkit-min-device-pixel-ratio:0) {  
        h2 {   
      margin-top: 0px;
      }
    }
    
      h2 div {
        display:inline;
        float:right;
      }
      #imagenTopic {
        display: inline;
        float: left;
        margin-left: 10px;
        text-align: left;
        width: 280px;
      }
      #imagenTopic img {
        margin-right: 40px;
      }
      hr {
        background-color: #CCCCCC;
        border-width: 0;
        height: 1px;
      }
      ul#datosFicha {
        border-collapse: collapse;
        color: #666666;
        font-family: arial,sans-serif;
        font-size: 13px;
        font-style: normal;
        font-variant: normal;
        font-weight: normal;
        letter-spacing: normal;
        line-height: 17px;
        text-align: left;
        text-indent: 0;
        text-transform: none;
        white-space: normal;
        word-spacing: 0;
      }
      ul#datosFicha li {
        border-collapse: collapse;
        color: #0b5394;
        font-family: arial,sans-serif;
        font-size: 12px;
        font-style: normal;
        font-variant: normal;
        font-weight: normal;
        letter-spacing: normal;
        line-height: 17px;
        word-spacing: 0;
        text-align: left;
        text-indent: 0;
        text-transform: none;
        white-space: normal;
      }
      
      ul#datosFicha li span,
      ul#listaproductos span li  {
        font-family: arial,sans-serif;
        font-size: 12px;
        line-height: 17px;
        text-align: justify;
        color: #666666;
      }
      ul#listaproductos {
        margin-left: 250px;
      }
      
      #izquierda {
        width: 470px;
        float:left;
        margin-right:8px;
      }
      
      #derecha {
      
      width: 470px;
      float:left;
      }
      
     #topleft {
      padding-left:12px;
      border: 1px solid #d0d0d0;
      margin-bottom:20px;
     -moz-border-radius: 10px;
     -webkit-border-radius: 10px;
     background-color: #FFFFFF;
      }


      #bottomleft {
      padding-left:12px;
      border: 1px solid #d0d0d0;
      margin-bottom:20px;
     -moz-border-radius: 10px;
     -webkit-border-radius: 10px;
     background-color: #FFFFFF;
      }

      #topright {
      padding-left:12px;
      border: 1px solid #d0d0d0;
      margin-bottom:20px;
     -moz-border-radius: 10px;
     -webkit-border-radius: 10px;
     background-color: #FFFFFF;
      }

      #bottomright {
      padding-left:12px;
      border: 1px solid #d0d0d0;
      margin-bottom:20px;
     -moz-border-radius: 10px;
     -webkit-border-radius: 10px;
   background-color: #FFFFFF;
      }    

      #izquierdaTL {
      
        padding-top:0px;
        width:auto;
        float:left;
      }

      #derechaTL {
        width:auto;
        margin-left:140px;
      }

      #security1 {
      padding-top:10px;
      padding-left:235px;
      }

 .topic {
        padding-left:20px;
        padding-bottom:5px;
        margin-bottom:4px;
        overflow:hidden;
        height: 59px;
        width: 216px;
       /* font-family:cursive;*/
        font-size: 19px;
        font-style: normal;
        font-variant: normal;
        font-weight: "550";
        letter-spacing: normal;
        line-height: 17px;
        text-align: left;
        text-indent: 0;
        text-transform: none;
        white-space: normal;
        word-spacing: 0;
        color:#000000
        margin-top:10px;
         

}

.summary {
width:260px;
height:80px;
overflow:hidden;
padding-left:7px;
font-size:12px;
font-family:Arial;
display:none;
}


.place {
 display:none;
 }   


       .infoviajero {
       overflow:hidden;
       border-top: 1px solid #d0d0d0;
       height:35px;
       }

   
      .bbvatraveller {
       overflow:hidden;
       width:185px;
       padding-left:20px;
       padding-top:10px;
       float:left;

       font-family: arial,sans-serif;
       font-size: 12px;
       line-height: 17px;
       text-align: justify;
}

 .urlmoreinfo {
   width:55px;
       height:25px;
       padding-right: 12px;
       float:left;
       color:#62B4E6;  
       padding-top:10px;

       font-family: arial,sans-serif;
       font-size: 12px;
       line-height: 17px;
       text-align: justify;
 }
       
    .urlmoreinfo a {
       text-decoration: none;
    }
 #findings h2 {
        border-bottom: 1px solid #cacaca;
        font-family: "BBVA Web Light", arial, sans-serif;
        font-size: 53px;
        margin: 0 0 10px 0;
        padding-bottom: 13px;
        box-shadow: 0px 1px white;
        color:#3B3B3B;
      }
     #findings h2 span {
        font-family: "BBVA Web Medium", arial, sans-serif;
      }
	 #home h2 {
		font-size: 32px;
        font-weight: normal;
        margin: 0px 0 5px 0;
        padding-bottom: 5px;
        position:relative;
		top:27px;
		font-family: "BBVA Web Light", arial, sans-serif;
		width:300px;   
		padding-top: 20px;
	 }
	 #home h2 span{
		font-weight: bold;
	 }
	/*JDLL*/
    #imagefindings0 img,
#imagefindings1 img,
#imagefindings2 img,
#imagefindings3 img	{
		width: 182px;
		height: 140px;
	 }
    </style>
  
<!--[if lt IE 9]>
<style>

#izquierdaTL {
    padding-top:3px;
}


#derechaTL {
width:20px;
}


.topic {
        margin-bottom:4px;
        overflow:hidden;
        height: 30px;
}

.summary {
width:260px;
height:95px;
overflow:hidden;
padding-left:7px;
font-size:12px;
font-family:Arial;
}


.infoviajero {
width:305px;

}


.urlmoreinfo {
float:left;
width:65px;
}

#security1 {
padding-top:10px;
padding-left:227px;
}

h2 {   
 padding-top: 20px;

}

</style>
<![endif]-->


<style>
	
	.blockFinding {
		float: left;
		padding-left: 12px;
border: 1px solid #D0D0D0;
margin-bottom: 20px;
-moz-border-radius: 10px;
-webkit-border-radius: 10px;
background-color: white;
width: 47%;
margin-right: 15px;
	}
	
	
</style>

<div id="lastfindings">
      
	<!--<div class="blockFinding">
				
		<div id="security0"></div>
		<div id="topic0" class="topic"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>
		<div id="place0" class="place"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>
		<div id="summary0" class="summary"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>  
		<div id ="infoviajero" class="infoviajero">
			<div id="bbvatraveller0" class="bbvatraveller"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>
			<div id="urlmoreinfo0" class="urlmoreinfo"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>
		</div>
		
	</div>	-->

</div>

    
<script type="text/javascript">
      
	console.debug('32 findings.xml'); 
	
    //https://docs.google.com/a/bbva.com/spreadsheet/ccc?key=0AqlvxYdNvmcRdFZZLXlCdWZnM25qZEVIMmVYdkpraFE#gid=0
	
	var gadgetHelper = null;  
	var prefs = new _IG_Prefs(); // User preferences      
	var urlTable = prefs.getString("_table_query_url");    
            
    _IG_RegisterOnloadHandler(loadVisualizationAPI);
      
    function loadVisualizationAPI()
	{
		google.load("visualization", "1", {"packages": ["table"]});
		google.setOnLoadCallback(sendQuery);
	}
 
	function sendQuery()
	{
		gadgetHelper = new google.visualization.GadgetHelper();
		
		var query = gadgetHelper.createQueryFromPrefs(prefs);  
		
		var opts = {dataType:'jsonp'};     

		var query = new google.visualization.Query(urlTable, opts);  
		var topic = gadgets.util.getUrlParameters()["parent"].split("=");
		var situation = gadgets.util.getUrlParameters()["parent"];

		if(situation.indexOf('topic')== -1)
		{
			//document.getElementById("home").innerHTML = "<h2>Last <span>Findings</span></h2>";
			//document.getElementById("all").innerHTML = '<a target="_parent" href="https://sites.google.com/a/bbva.com/findings/home/topics">View all topics</a></div>';
			var querytosend = "select max(D),A,C,L,G,R,Y group by A,C,L,G,R,Y order by max(D) desc limit 4";
		}
		else
		{
			//document.getElementById("findings").innerHTML = "<h2>Last <span>Findings</span></h2>";
			var querytosend = "select max(D),A,C,L,G,R,Y where A like '%"+topic[1]+"%'group by A,C,L,G,R,Y order by max(D)  desc ";
		}
		
		query.setQuery(querytosend);        
		query.send(handleQueryResponse);
	}
	
    function handleQueryResponse(response)
    {	 
		if (!gadgetHelper.validateResponse(response)) 
		{ 
			return; 
		}
		
        data = response.getDataTable();    
		
        //console.debug('data.getNumberOfRows(): ' + data.getNumberOfRows());
	   
        var filas = data.getNumberOfRows();
		
		//console.debug('findings.xml , filas -> '+filas);
		
		//console.debug('findings.xml , data -> '+data);
		
		
	/*	var topicname = data.getValue(i,1);

		switch(topicname)
		{
			case 'Security': document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
			case 'Banca':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
			case 'Scouting':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
			case 'Mobility':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
			case 'Boundaries':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
			case 'Technology':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
			case 'Innovation':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
			case 'Enterprise 2.0':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
			case 'Payments':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
		}
			*/
		
		for(var i = 0; i < filas; i++) 
		{
			var html = "";
		 
			html += '<div class="blockFinding">';
			
			html += '<div id="topicName' + i + '" class="label-topicName">security</div>';
		  
		  
			html += '<div id="imagefindings' + i + '" class="image"><img width="15" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/Enterprise%202.0.jpg"/></div>';
			/*html += '<h3 id="summary' + i + '" class="label-summary">Lorem ipsum dolor consectetur elit.</h3>';
		  
			html += '<div class="infoviajero">';
			html += '<div id="bbvatraveller' + i + '" class="label-bbvatraveller">BBVA Traveller - John Snow</div>';
			html += '<div id="urlmoreinfo' + i + '" class="more-link">More Info</div>';
			html += '</div>';*/
			html += '</div>';
		  
		  
		  
		   /*
		  
		  html += '<div class="blockFinding">';		
		  
	      html += '<div id="topicValue' + i + '" class="labelTopicValue brown" >' + Security + '</div>';
		  html += '<div id="imagefindings' + i + '" class="image"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>';
          html += '<h3 id="summary' + i + '"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></h3>';
		  html += '<div id="topic' + i + '"></div>';
          html += '<div id="bbvatraveller' + i + '"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>';
          html += '<div id="urlmoreinfo' + i + '" class="more-link"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>';
          html += '</div></div>';
		  */
		  
		  
		  <div class="infoviajero" id="infoviajero1">
				<div class="bbvatraveller" id="bbvatraveller2"><b>BBVA Traveller -</b> John Snow</div>
				<div class="urlmoreinfo" id="urlmoreinfo2"><a href="https://sites.google.com/a/bbva.com/travellers/home/past-travels/epic-europe" target="_top">More Info</a></div>
				</div>
				
				
		  
		  /*
		  html += '<div id="topicValue' + i + '" class="labelTopicValue brown" >' + topicname + '</div>';
		  html += '<div id="imagefindings' + i + '" class="image"><img class="loading" width="15" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/Enterprise%202.0.jpg"/></div>';
          html += '<h3 id="summary' + i + '"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></h3>';
		  html += '<div id="topic' + i + '"></div>';
          html += '<div id="bbvatraveller' + i + '"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>';
          html += '<div id="urlmoreinfo' + i + '" class="more-link"><img class="loading" width="15" src="http://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/loading.gif"/></div>';
         
		 html += '</div></div>';
		  */

          document.getElementById("lastfindings").innerHTML += html;
        }

		/*
        for(var i = 0; i < filas; i++) {
					  
		    var topicname = data.getValue(i,1);
		 
			switch(topicname){
				case 'Security': document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
				case 'Banca':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
				case 'Scouting':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
				case 'Mobility':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
				case 'Boundaries':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
				case 'Technology':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
				case 'Innovation':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
				case 'Enterprise 2.0':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
				case 'Payments':  document.getElementById("security1").innerHTML = '<img class="loading" src="https://bbvatravellersgadgets.googlecode.com/svn/trunk/Findings/images/Images_Findings_Home/security_brown.png">'+topicname+'</img>';break;
			}
          
             document.getElementById("topic"+i).innerHTML = data.getValue(i,1);
			 document.getElementById("urlmoreinfo"+i).innerHTML = '<a href="'+data.getValue(i,5)+'" target="_top">More Info</a>';
             document.getElementById("place"+i).innerHTML = data.getValue(i,2);
             document.getElementById("summary"+i).innerHTML = data.getValue(i,6);
             document.getElementById("bbvatraveller"+i).innerHTML = "<b>BBVA Traveller -</b> "+data.getValue(i,3);
             document.getElementById("imagefindings"+i).innerHTML ='<img border="0" src="' + data.getValue(i,4) +'">';  
        
        
        }
		
		
		*/
      }
      
      
      
    </script>
    ]]>
  </Content>
</Module>